fixing a lot of caret positioning issues. Thanks to @onuradsay
