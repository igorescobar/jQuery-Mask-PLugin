!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery||window.Zepto)}(function(a){"use strict";var b=function(b,c,d){var e,f=this;b=a(b),c="function"==typeof c?c(b.val(),void 0,b,d):c,f.init=function(){d=d||{},f.byPassKeys=[9,16,17,18,36,37,38,39,40,91],f.translation={0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}},f.translation=a.extend({},f.translation,d.translation),f=a.extend(!0,{},f,d),b.each(function(){d.maxlength!==!1&&b.attr("maxlength",c.length),d.placeholder&&b.attr("placeholder",d.placeholder),b.attr("autocomplete","off"),g.destroyEvents(),g.events();var a=g.getCaret();g.val(g.getMasked()),g.setCaret(a+g.getMaskCharactersBeforeCount(a,!0))})};var g={getCaret:function(){var a,c=0,d=b.get(0),e=document.selection,f=d.selectionStart;return e&&!~navigator.appVersion.indexOf("MSIE 10")?(a=e.createRange(),a.moveStart("character",b.is("input")?-b.val().length:-b.text().length),c=a.text.length):(f||"0"===f)&&(c=f),c},setCaret:function(a){if(b.is(":focus")){var c,d=b.get(0);d.setSelectionRange?d.setSelectionRange(a,a):d.createTextRange&&(c=d.createTextRange(),c.collapse(!0),c.moveEnd("character",a),c.moveStart("character",a),c.select())}},events:function(){b.on("keydown.mask",function(){e=g.val()}),b.on("keyup.mask",g.behaviour),b.on("paste.mask drop.mask",function(){setTimeout(function(){b.keydown().keyup()},100)}),b.on("change.mask",function(){b.data("changeCalled",!0)}),b.on("blur.mask",function(b){var c=a(b.target);c.prop("defaultValue")!==c.val()&&(c.prop("defaultValue",c.val()),c.data("changeCalled")||c.trigger("change")),c.data("changeCalled",!1)}),b.on("focus.mask",function(b){var c=a(b.target);d.selectonfocus===!0&&c.select()}),b.on("focusout.mask",function(){d.clearIfNotMatch&&g.val().length<c.length&&g.val("")})},destroyEvents:function(){b.off("keydown.mask keyup.mask paste.mask drop.mask change.mask blur.mask focusout.mask").removeData("changeCalled")},val:function(a){var c=b.is("input");return arguments.length>0?c?b.val(a):b.text(a):c?b.val():b.text()},getMaskCharactersBeforeCount:function(a,b){for(var d=0,e=0,g=c.length;g>e&&a>e;e++)f.translation[c.charAt(e)]||(a=b?a+1:a,d++);return d},determineCaretPos:function(a,b,d,e){var h=f.translation[c.charAt(Math.min(a-1,c.length-1))];return h?Math.min(a+d-b-e,d):g.determineCaretPos(a+1,b,d,e)},behaviour:function(b){b=b||window.event;var c=b.keyCode||b.which;if(-1===a.inArray(c,f.byPassKeys)){var d=g.getCaret(),e=g.val(),h=e.length,i=h>d,j=g.getMasked(),k=j.length,l=g.getMaskCharactersBeforeCount(k-1)-g.getMaskCharactersBeforeCount(h-1);return j!==e&&g.val(j),!i||65===c&&b.ctrlKey||(8!==c&&46!==c&&(d=g.determineCaretPos(d,h,k,l)),g.setCaret(d)),g.callbacks(b)}},getMasked:function(a){var b,e,h=[],i=g.val(),j=0,k=c.length,l=0,m=i.length,n=1,o="push",p=-1;for(d.reverse?(o="unshift",n=-1,b=0,j=k-1,l=m-1,e=function(){return j>-1&&l>-1}):(b=k-1,e=function(){return k>j&&m>l});e();){var q=c.charAt(j),r=i.charAt(l),s=f.translation[q];s?(r.match(s.pattern)?(h[o](r),s.recursive&&(-1===p?p=j:j===b&&(j=p-n),b===p&&(j-=n)),j+=n):s.optional&&(j+=n,l-=n),l+=n):(a||h[o](q),r===q&&(l+=n),j+=n)}var t=c.charAt(b);return k!==m+1||f.translation[t]||h.push(t),h.join("")},callbacks:function(a){var f=g.val(),h=g.val()!==e;h===!0&&"function"==typeof d.onChange&&d.onChange(f,a,b,d),h===!0&&"function"==typeof d.onKeyPress&&d.onKeyPress(f,a,b,d),"function"==typeof d.onComplete&&f.length===c.length&&d.onComplete(f,a,b,d)}};f.remove=function(){var a=g.getCaret(),b=g.getMaskCharactersBeforeCount(a);g.destroyEvents(),g.val(f.getCleanVal()).removeAttr("maxlength"),g.setCaret(a-b)},f.getCleanVal=function(){return g.getMasked(!0)},f.init()};a.fn.mask=function(c,d){return this.unmask(),this.each(function(){a(this).data("mask",new b(this,c,d))})},a.fn.unmask=function(){return this.each(function(){try{a(this).data("mask").remove()}catch(b){}})},a.fn.cleanVal=function(){return a(this).data("mask").getCleanVal()},a("*[data-mask]").each(function(){var b=a(this),c={},d="data-mask-";"true"===b.attr(d+"reverse")&&(c.reverse=!0),"false"===b.attr(d+"maxlength")&&(c.maxlength=!1),"true"===b.attr(d+"clearifnotmatch")&&(c.clearIfNotMatch=!0),"true"===b.attr(d+"selectonfocus")&&(c.selectonfocus=!0),b.mask(b.attr("data-mask"),c)})});